<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üì§ Export PDF Data - FreeBookHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white">

  <main class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6">üì§ Export Uploaded Book Data</h1>

    <input type="password" id="adminPassword" placeholder="Enter Admin Password" class="w-full px-4 py-2 border rounded mb-4 dark:bg-gray-800 dark:border-gray-600" />

    <button onclick="exportCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full">‚¨áÔ∏è Download CSV</button>

    <p id="status" class="mt-4 text-sm text-gray-700 dark:text-gray-300"></p>

    <div class="text-center mt-8">
      <a href="admin.html" class="text-blue-500 hover:underline">‚¨ÖÔ∏è Back to Admin Panel</a>
    </div>
  </main>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwxnhm-fxAKRmLk825VdEjm6bD_UBw6AO-XnlXsRTaw-QsrgxAzjIv7SjUdNPd3F7yc1Q/exec";

    async function exportCSV() {
      const password = document.getElementById("adminPassword").value.trim();
      const status = document.getElementById("status");

      if (!password) {
        alert("Please enter admin password.");
        return;
      }

      status.innerText = "üì¶ Preparing CSV...";

      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        if (!Array.isArray(data)) {
          throw new Error("Invalid data format.");
        }

        let csvContent = "Title,Link,Size (MB),Date,Folder\n";
        data.forEach(row => {
          csvContent += `"${row.title}","${row.link}",${row.size},"${row.date}","${row.folder || ""}"\n`;
        });

        const blob = new Blob([csvContent], { type: "text/csv" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "FreeBookHub_Uploads.csv";
        a.click();
        URL.revokeObjectURL(url);

        status.innerText = "‚úÖ Export complete.";
      } catch (err) {
        console.error(err);
        status.innerText = "‚ùå Failed to export CSV.";
      }
    }
  </script>

</body>
</html>
