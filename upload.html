<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload PDF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    form {
      display: flex;
      flex-direction: column;
      max-width: 400px;
    }
    input, button {
      margin-top: 1rem;
      padding: 0.5rem;
    }
    #responseMsg {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>Upload a PDF Book</h1>
  <form id="uploadForm">
    <input type="text" name="description" placeholder="Enter PDF Title" required />
    <input type="file" name="file" accept="application/pdf" required />
    <input type="text" name="pdfPassword" placeholder="Optional PDF Password" />
    <button type="submit">Upload</button>
  </form>
  <p id="responseMsg"></p>

  <script>
const UPLOAD_API_URL = "https://script.google.com/macros/s/AKfycbwxnhm-fxAKRmLk825VdEjm6bD_UBw6AO-XnlXsRTaw-QsrgxAzjIv7SjUdNPd3F7yc1Q/exec";

document.getElementById("uploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const title = document.querySelector("input[name='description']").value;
  const file = document.querySelector("input[name='file']").files[0];
  const password = document.querySelector("input[name='pdfPassword']").value;

  if (!file || file.type !== "application/pdf") {
    alert("Please select a valid PDF file.");
    return;
  }

  const progressText = document.getElementById("responseMsg");
  progressText.innerText = "üì§ Preparing upload...";

  const reader = new FileReader();

  reader.onload = function () {
    const base64File = reader.result.split(",")[1];

    const data = new URLSearchParams({
      file: base64File,
      filename: file.name,
      description: title,
      pdfPassword: password
    });

    const xhr = new XMLHttpRequest();
    xhr.open("POST", UPLOAD_API_URL, true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

    xhr.upload.onprogress = function (event) {
      if (event.lengthComputable) {
        const percent = Math.round((event.loaded / event.total) * 100);
        progressText.innerText = `üì§ Uploading... ${percent}%`;
      }
    };

    xhr.onload = function () {
      if (xhr.status === 200 && xhr.responseText.startsWith("https://")) {
        progressText.innerHTML = `‚úÖ Uploaded! <a href="${xhr.responseText}" target="_blank">View PDF</a>`;
      } else {
        progressText.innerText = "‚ùå Upload failed: " + xhr.responseText;
      }
    };

    xhr.onerror = function () {
      progressText.innerText = "‚ùå Upload error.";
    };

    xhr.send(data);
  };

  reader.readAsDataURL(file);
});
</script>
</body>
</html>
