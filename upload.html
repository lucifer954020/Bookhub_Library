<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload PDF - FreeBookHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-white text-gray-900 p-6 max-w-xl mx-auto">

  <h1 class="text-2xl font-bold mb-4">üì§ Upload a PDF Book</h1>

  <form id="uploadForm" class="space-y-4">
    <input type="text" name="description" placeholder="PDF Title" class="w-full p-2 border rounded" required />
    <input type="file" name="file" accept="application/pdf" class="w-full p-2 border rounded" required />
    <input type="text" name="folderName" placeholder="Optional Folder Name" class="w-full p-2 border rounded" />
    <input type="text" name="pdfPassword" placeholder="Optional PDF Password" class="w-full p-2 border rounded" />
    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Upload</button>
  </form>

  <div id="progressText" class="mt-4 text-sm text-gray-700"></div>

  <script>
    const UPLOAD_API_URL = "https://script.google.com/macros/s/AKfycbwxnhm-fxAKRmLk825VdEjm6bD_UBw6AO-XnlXsRTaw-QsrgxAzjIv7SjUdNPd3F7yc1Q/exec";

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const progressText = document.getElementById("progressText");

      const title = e.target.description.value.trim();
      const file = e.target.file.files[0];
      const password = e.target.pdfPassword.value.trim();
      const folderName = e.target.folderName.value.trim();

      if (!file || file.type !== "application/pdf") {
        alert("Please select a valid PDF file.");
        return;
      }

      progressText.textContent = "üì§ Preparing file...";

      const reader = new FileReader();
      reader.onload = function () {
        const base64File = reader.result.split(",")[1];

        const data = new URLSearchParams({
          file: base64File,
          filename: file.name,
          description: title,
          pdfPassword: password,
          folderName: folderName
        });

        const xhr = new XMLHttpRequest();
        xhr.open("POST", UPLOAD_API_URL, true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        xhr.upload.onprogress = function (event) {
          if (event.lengthComputable) {
            const percent = Math.round((event.loaded / event.total) * 100);
            progressText.textContent = `üì§ Uploading... ${percent}%`;
          }
        };

        xhr.onload = function () {
          if (xhr.status === 200 && xhr.responseText.startsWith("https://")) {
            progressText.innerHTML = `‚úÖ Uploaded! <a href="${xhr.responseText}" target="_blank" class="text-blue-700 underline">View PDF</a>`;
          } else {
            progressText.textContent = "‚ùå Upload failed: " + xhr.responseText;
          }
        };

        xhr.onerror = function () {
          progressText.textContent = "‚ùå Upload error.";
        };

        xhr.send(data);
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
